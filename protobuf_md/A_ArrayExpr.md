# –ü—Ä–∞–≤–∏–ª–æ: `A_ArrayExpr.java` - –ê–Ω–∞–ª–∏–∑ –º–∞—Å—Å–∏–≤–æ–≤ –≤ PostgreSQL

## üìå –û–±–∑–æ—Ä
`A_ArrayExpr.java` - –∫–ª—é—á–µ–≤–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–ª–∞–≥–∏–Ω–∞ SonarPostgres –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ **—Ä–∞–±–æ—Ç—ã —Å –º–∞—Å—Å–∏–≤–∞–º–∏** –≤ SQL-–∑–∞–ø—Ä–æ—Å–∞—Ö PostgreSQL. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–∞–∫ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—å (Visitor) ANTLR4 –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º.

## üîç –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –≤—ã—Ö–æ–¥–∞ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã –º–∞—Å—Å–∏–≤–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤ –º–∞—Å—Å–∏–≤–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –º–∞—Å—Å–∏–≤–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π PostgreSQL —Å –º–∞—Å—Å–∏–≤–∞–º–∏:

```sql
SELECT array[1,2,3][2];  -- –î–æ—Å—Ç—É–ø –ø–æ –∏–Ω–¥–µ–∫—Å—É
SELECT ARRAY_LENGTH(ids, 1);  -- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π
```
## üõ†Ô∏è –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
```java
public class A_ArrayExpr extends PostgresParserBaseVisitor<Void> {
    @Override
    public Void visitArrayAccess(PostgresParser.ArrayAccessContext ctx) {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∞—Å—Å–∏–≤—É
        checkArrayIndexSafety(ctx.index());
        return super.visitArrayAccess(ctx);
    }
    
    private void checkArrayIndexSafety(ExprContext indexExpr) {
        // –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω–¥–µ–∫—Å–æ–≤
    }
}
```

## üö® –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ–º—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
1. –í—ã—Ö–æ–¥ –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã –º–∞—Å—Å–∏–≤–∞

 –ü—Ä–∏–º–µ—Ä SQL:

 ```sql
SELECT product_prices[10] FROM inventory 
WHERE product_id = 123;
```
**–£—Å–ª–æ–≤–∏–µ**: –ö–æ–≥–¥–∞ –∞–Ω–∞–ª–∏–∑ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –º–∞—Å—Å–∏–≤ –æ–±—ã—á–Ω–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –º–µ–Ω—å—à–µ 10 —ç–ª–µ–º–µ–Ω—Ç–æ–≤.

**2. –°–º–µ—à–∞–Ω–Ω—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö**

**–ü—Ä–∏–º–µ—Ä:**

```sql
UPDATE user_settings 
SET preferences = ARRAY[1, 'admin', true]  -- –¶–µ–ª–æ–µ, —Å—Ç—Ä–æ–∫–∞, –±—É–ª–µ–≤–æ
WHERE user_id = 456;
```

**3. –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**

**–ü—Ä–∏–º–µ—Ä:**

```sql
SELECT * FROM large_table 
WHERE id = ANY(ARRAY(SELECT generate_series(1,1000000)));
```

## üõ°Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤–∏–ª–∞

```yaml
rules:
  postgres-array-safety:
    enabled: true
    max-index: 100
    check-type-consistency: true
```

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø**
```sql
-- –í–º–µ—Å—Ç–æ:
SELECT array_value[5] FROM table;

-- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
SELECT CASE WHEN array_length(array_value,1) >= 5 
       THEN array_value[5] 
       END FROM table;
```

**–¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã**

```sql
-- –í–º–µ—Å—Ç–æ:
SELECT ARRAY[1,2,3];

-- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
SELECT ARRAY[1,2,3]::integer[];
```

## üè∑Ô∏è –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ

|–ü–∞—Ä–∞–º–µ—Ç—Ä|–ó–Ω–∞—á–µ–Ω–∏–µ
|-|-
|–ö–ª—é—á –ø—Ä–∞–≤–∏–ª–∞|postgres:array-safety
|–í–∞–∂–Ω–æ—Å—Ç—å|–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è
|–¢–∏–ø|–û—à–∏–±–∫–∞
|–í—Ä–µ–º—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è|15 –º–∏–Ω—É—Ç
|–¢–µ–≥–∏|postgres, –º–∞—Å—Å–∏–≤, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

## –ü—Ä–∏–º–µ—Ä –∞–Ω–∞–ª–∏–∑–∞

**–ò—Å—Ö–æ–¥–Ω—ã–π SQL**

```sql
SELECT customer_orders[10] 
FROM customers 
WHERE region_id = 5;
```

1. –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –æ–±—Ä–∞—â–µ–Ω–∏—è *customer_orders[10]*
2. –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∏–Ω–¥–µ–∫—Å 10 –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –¥–æ–ø—É—Å—Ç–∏–º—ã–π —Ä–∞–∑–º–µ—Ä
3. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –º–∞—Å—Å–∏–≤–∞
4. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö
```mermaid
graph TD
    A[SQL-–∑–∞–ø—Ä–æ—Å] --> B[–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞]
    B --> C[–£–∑–µ–ª ArrayAccess]
    C --> D{–ò–Ω–¥–µ–∫—Å –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö?}
    D -->|–î–∞| E[–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å]
    D -->|–ù–µ—Ç| F[–°–æ–æ–±—â–∏—Ç—å –æ–± –æ—à–∏–±–∫–µ]
```